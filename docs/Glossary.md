# Glossary.md

Глоссарий доменных терминов системы **Planner**.  
Документ является **нормативным**: термины, роли и статусы должны использоваться
строго в указанном смысле в коде, API, документации и UI.

---

## 1. Основные доменные сущности

### Task (Задача)

**Task** — атомарная единица работы в системе.

Характеристики:
- принадлежит `org_id` и `project_id`,
- имеет статус (`status`) и версию (`row_version`),
- может быть связана с `deliverable`,
- изменяется **только** через FSM.

Важно:
- статус нельзя менять напрямую (`PATCH`),
- все изменения проходят через `TaskTransition`.

---

### Deliverable (Изделие / Результат)

**Deliverable** — физический или логический объект, ради которого выполняются задачи.

Примеры:
- изделие,
- партия,
- заказ,
- коробка,
- узел.

Deliverable:
- может иметь несколько связанных задач,
- является точкой входа для QC,
- используется для привязки fix-task.

---

### TaskTransition (Переход задачи)

**TaskTransition** — неизменяемая запись о применённом FSM-действии.

Назначение:
- аудит,
- история,
- идемпотентность,
- защита от гонок.

Ключевые поля:
- `action`
- `from_status`
- `to_status`
- `expected_row_version`
- `result_row_version`
- `client_event_id`

---

### Fix-task (Задача на исправление)

**Fix-task** — специальная задача, созданная для устранения дефекта.

Свойства:
- всегда связана с `deliverable`,
- имеет ссылку на исходную задачу (`origin_task_id`),
- проходит стандартный FSM,
- не «возвращает» автоматически исходную задачу.

Fix-task — это **не состояние**, а **новая задача**.

---

### QC (Quality Control)

**QC** — домен контроля качества.

Принципиально:
- QC **не управляет Task FSM**,
- QC работает через `deliverable` и `qc_inspections`,
- QC может инициировать создание fix-task,
  но не меняет статусы задач напрямую.

---

## 2. Статусы задачи (TaskStatus)

Статусы отражают **жизненный цикл выполнения работы**.

### new
Задача создана, но ещё не запланирована.

---

### planned
Задача принята в план, но ещё не назначена исполнителю.

---

### assigned
Назначен исполнитель, работа ещё не начата.

---

### in_progress
Исполнитель начал работу над задачей.

---

### in_review
Работа завершена исполнителем и ожидает проверки (лид/ответственный).

---

### rejected
Работа отклонена.
Возможное следствие — создание fix-task.

---

### done
Работа принята и завершена.

---

### canceled
Задача отменена и больше не участвует в процессе.

---

## 3. Действия FSM (TaskAction)

Действия — это **намерения**, а не статусы.

### plan
Перевести задачу из `new` → `planned`.

---

### assign
Назначить исполнителя (`planned` → `assigned`).

---

### unassign
Снять исполнителя (`assigned` → `planned`).

---

### start
Начать выполнение (`assigned` → `in_progress`).

---

### submit
Сообщить о завершении работы (`in_progress` → `in_review`).

---

### approve
Принять результат (`in_review` → `done`).

---

### reject
Отклонить результат (`in_review` → `rejected`),  
возможен side-effect: создание fix-task.

---

## 4. Роли (Roles)

Роли описывают **ответственность человека в процессе**, а не технические права.

---

### system
Системный актор (bootstrap, автоматизация).

---

### lead
Руководитель работ.
Отвечает за планирование, проверку и принятие.

---

### supervisor
Контролирующая роль между lead и исполнителем.

---

### executor
Исполнитель, выполняющий работу.

---

### qualified_worker
Квалифицированный исполнитель,
имеющий право на инициативные исправления.

---

### qc
Контроль качества.
Работает **вне Task FSM**.

---

### project_creator
Создатель проекта / изделия.

---

### receiver
Получатель результата.

---

### internal_controller
Внутренний управляющий процесс (системный контроль).

---

## 5. RBAC-термины

### Permission (Разрешение)

Строка вида:
- task.plan
- task.assign
- fix.qc_reject

Связывает:
(role) → (allowed actions)


FSM **не проверяет** разрешения.

---

## 6. Идемпотентность

### client_event_id

UUID, передаваемый клиентом для защиты от повторов.

Правила:
- одинаковый `client_event_id` + тот же смысл → повтор допустим,
- одинаковый `client_event_id` + другой смысл → `409 Conflict`.

---

### IdempotencyConflict

Ошибка, означающая:
> клиент пытается повторно использовать `client_event_id`
> для другого запроса.

---

## 7. Версионность

### row_version

Целое число, увеличивается при каждом успешном FSM-переходе.

Используется для:
- optimistic locking,
- защиты от lost update.

---

### VersionConflict

Ошибка:
expected_row_version != actual_row_version


---

## 8. Архитектурные термины

### FSM (Finite State Machine)
Чистая функция, описывающая допустимые переходы состояний.

---

### Side-effect
Побочное действие FSM (например, создание fix-task).

---

### Variant A (QC Model)
Архитектурное решение:
> QC не управляет Task FSM напрямую.

---

## 9. Зафиксированные смыслы

- Статус ≠ действие
- Fix-task ≠ возврат задачи
- QC ≠ FSM
- Transition ≠ update
- TaskTransition — источник истины

---

**Glossary.md зафиксирован.**
